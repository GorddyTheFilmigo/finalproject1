<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 24px 32px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            color: #1a202c;
            font-weight: 700;
        }

        .header-info {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .refresh-btn, .config-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .refresh-btn {
            background: #48bb78;
        }

        .refresh-btn:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .config-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .timeframe {
            padding: 8px 16px;
            background: #f7fafc;
            border-radius: 8px;
            color: #4a5568;
            font-size: 14px;
            font-weight: 600;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .metric-card:hover {
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
            transform: translateY(-4px);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 700;
        }

        .metric-change.positive {
            color: #48bb78;
        }

        .metric-change.negative {
            color: #f56565;
        }

        .metric-title {
            color: #718096;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .metric-value {
            color: #1a202c;
            font-size: 32px;
            font-weight: 700;
        }

        .departments-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 20px;
        }

        .departments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .dept-card {
            background: #f7fafc;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        .dept-card:hover {
            border-color: #667eea;
            transform: translateX(4px);
        }

        .dept-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .dept-name {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
        }

        .efficiency-badge {
            padding: 6px 14px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
        }

        .dept-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            color: #718096;
            font-size: 14px;
        }

        .stat-value {
            font-weight: 700;
            color: #1a202c;
            font-size: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .alerts-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .alert-item {
            padding: 16px;
            border-left: 4px solid #667eea;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .alert-item:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .alert-item.warning {
            border-left-color: #f6ad55;
            background: #fffaf0;
        }

        .alert-item.success {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .alert-message {
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .alert-time {
            color: #a0aec0;
            font-size: 13px;
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 24px 28px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 4px;
        }

        .modal-subtitle {
            color: #718096;
            font-size: 14px;
        }

        .modal-body {
            padding: 28px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-label input {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            cursor: pointer;
        }

        .modal-footer {
            padding: 20px 28px;
            border-top: 2px solid #e2e8f0;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn-cancel, .btn-save {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: #edf2f7;
            color: #4a5568;
        }

        .btn-cancel:hover {
            background: #e2e8f0;
        }

        .btn-save {
            background: #667eea;
            color: white;
        }

        .btn-save:hover {
            background: #5a67d8;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .header-info {
                flex-direction: column;
                width: 100%;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .departments-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <div id="errorContainer"></div>

        <div class="header">
            <h1 id="orgName">Operations Department</h1>
            <div class="header-info">
                <div class="timeframe" id="timeframe">This Month</div>
                <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
                <button class="config-btn" onclick="openConfig()">‚öôÔ∏è Configure</button>
            </div>
        </div>

        <div class="metrics-grid" id="metricsGrid"></div>

        <div class="departments-section">
            <h2 class="section-title">Department Performance</h2>
            <div class="departments-grid" id="departmentsGrid"></div>
        </div>

        <div class="alerts-section" id="alertsSection">
            <h2 class="section-title">Recent Alerts & Notifications</h2>
            <div id="alertsList"></div>
        </div>
    </div>

    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Dashboard Configuration</h2>
                <p class="modal-subtitle">Customize your operations dashboard</p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Organization Name</label>
                    <input type="text" class="form-input" id="orgNameInput">
                </div>

                <div class="form-group">
                    <label class="form-label">Display Options</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="showFinancials">
                            <span>Show Financial Metrics</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showTeamMetrics">
                            <span>Show Team Metrics</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showAlerts">
                            <span>Show Alerts & Notifications</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeConfig()">Cancel</button>
                <button class="btn-save" onclick="saveConfig()">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // API Base URL - change this to your server URL
        const API_BASE = 'http://localhost:3000/api';

        let currentConfig = null;

        // Show/hide loading spinner
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        // Show error message
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<div class="error-message">‚ö†Ô∏è ${message}</div>`;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000);
        }

        // Fetch data from API
        async function fetchData(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${endpoint}:`, error);
                showError(`Failed to fetch data from ${endpoint}`);
                return null;
            }
        }

        // Post data to API
        async function postData(endpoint, data) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Error posting to ${endpoint}:`, error);
                showError(`Failed to save data to ${endpoint}`);
                return null;
            }
        }

        // Render metrics cards
        function renderMetrics(metrics, config) {
            const grid = document.getElementById('metricsGrid');
            
            const metricsData = [
                {
                    title: 'Operational Efficiency',
                    value: `${metrics.efficiency}%`,
                    change: metrics.efficiencyChange,
                    icon: 'üìä',
                    color: '#ebf8ff',
                    show: true
                },
                {
                    title: 'Productivity Score',
                    value: `${metrics.productivity}%`,
                    change: metrics.productivityChange,
                    icon: '‚ö°',
                    color: '#f0fff4',
                    show: true
                },
                {
                    title: 'On-Time Delivery',
                    value: `${metrics.onTimeDelivery}%`,
                    change: metrics.onTimeDeliveryChange,
                    icon: '‚è∞',
                    color: '#fef5e7',
                    show: true
                },
                {
                    title: 'Quality Score',
                    value: `${metrics.qualityScore}%`,
                    change: metrics.qualityScoreChange,
                    icon: '‚úì',
                    color: '#fce4ec',
                    show: true
                },
                {
                    title: 'Cost Variance',
                    value: `${metrics.costVariance}%`,
                    change: metrics.costVarianceChange,
                    icon: 'üí∞',
                    color: '#e8f5e9',
                    show: config.showFinancials
                },
                {
                    title: 'Total Headcount',
                    value: metrics.headcount,
                    change: metrics.headcountChange,
                    icon: 'üë•',
                    color: '#f3e5f5',
                    show: config.showTeamMetrics
                }
            ];

            grid.innerHTML = metricsData
                .filter(m => m.show)
                .map(metric => {
                    const isPositive = metric.change >= 0;
                    const changeClass = isPositive ? 'positive' : 'negative';
                    const arrow = isPositive ? '‚Üë' : '‚Üì';
                    
                    return `
                        <div class="metric-card">
                            <div class="metric-header">
                                <div class="metric-icon" style="background: ${metric.color};">${metric.icon}</div>
                                <div class="metric-change ${changeClass}">${arrow} ${Math.abs(metric.change)}%</div>
                            </div>
                            <div class="metric-title">${metric.title}</div>
                            <div class="metric-value">${metric.value}</div>
                        </div>
                    `;
                }).join('');
        }

        // Render departments
        function renderDepartments(departments) {
            const grid = document.getElementById('departmentsGrid');
            
            if (!departments || departments.length === 0) {
                grid.innerHTML = '<p style="color: #718096;">No department data available</p>';
                return;
            }

            grid.innerHTML = departments.map(dept => {
                const completionRate = ((dept.completed / dept.tasks) * 100).toFixed(1);
                const issueColor = dept.issues > 5 ? '#f56565' : '#48bb78';
                
                return `
                    <div class="dept-card">
                        <div class="dept-header">
                            <div class="dept-name">${dept.name}</div>
                            <div class="efficiency-badge">${dept.efficiency.toFixed(1)}% Efficiency</div>
                        </div>
                        <div class="dept-stats">
                            <div class="stat-row">
                                <span class="stat-label">Tasks Completed</span>
                                <span class="stat-value">${dept.completed}/${dept.tasks}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${completionRate}%"></div>
                            </div>
                            <div class="stat-row" style="padding-top: 8px;">
                                <span class="stat-label">Open Issues</span>
                                <span class="stat-value" style="color: ${issueColor}">${dept.issues}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render alerts
        function renderAlerts(alerts) {
            const list = document.getElementById('alertsList');
            
            if (!alerts || alerts.length === 0) {
                list.innerHTML = '<p style="color: #718096;">No alerts available</p>';
                return;
            }

            list.innerHTML = alerts.map(alert => `
                <div class="alert-item ${alert.type}">
                    <div class="alert-message">${getAlertIcon(alert.type)} ${alert.message}</div>
                    <div class="alert-time">${alert.time}</div>
                </div>
            `).join('');
        }

        function getAlertIcon(type) {
            switch(type) {
                case 'warning': return '‚ö†Ô∏è';
                case 'success': return '‚úÖ';
                case 'info': return '‚ÑπÔ∏è';
                default: return 'üìå';
            }
        }

        // Load all dashboard data
        async function loadDashboard() {
            showLoading();

            try {
                const [config, metrics, departments, alerts] = await Promise.all([
                    fetchData('/config'),
                    fetchData('/metrics'),
                    fetchData('/departments'),
                    fetchData('/alerts')
                ]);

                if (config) {
                    currentConfig = config;
                    document.getElementById('orgName').textContent = config.organizationName || 'Operations Department';
                    document.getElementById('timeframe').textContent = config.timeframe || 'This Month';
                }

                if (metrics) {
                    renderMetrics(metrics, config);
                }

                if (departments) {
                    renderDepartments(departments);
                }

                if (alerts && config.showAlerts) {
                    renderAlerts(alerts);
                    document.getElementById('alertsSection').style.display = 'block';
                } else {
                    document.getElementById('alertsSection').style.display = 'none';
                }

            } catch (error) {
                console.error('Error loading dashboard:', error);
                showError('Failed to load dashboard data. Please check your connection.');
            } finally {
                hideLoading();
            }
        }

        // Refresh data
        async function refreshData() {
            await loadDashboard();
        }

        // Open config modal
        function openConfig() {
            if (!currentConfig) return;
            
            document.getElementById('configModal').classList.add('active');
            document.getElementById('orgNameInput').value = currentConfig.organizationName || '';
            document.getElementById('showFinancials').checked = currentConfig.showFinancials;
            document.getElementById('showTeamMetrics').checked = currentConfig.showTeamMetrics;
            document.getElementById('showAlerts').checked = currentConfig.showAlerts;
        }

        // Close config modal
        function closeConfig() {
            document.getElementById('configModal').classList.remove('active');
        }

        // Save configuration
        async function saveConfig() {
            const updatedConfig = {
                organizationName: document.getElementById('orgNameInput').value,
                showFinancials: document.getElementById('showFinancials').checked,
                showTeamMetrics: document.getElementById('showTeamMetrics').checked,
                showAlerts: document.getElementById('showAlerts').checked,
                departments: currentConfig.departments,
                timeframe: currentConfig.timeframe
            };

            const result = await postData('/config', updatedConfig);
            
            if (result && result.success) {
                closeConfig();
                await loadDashboard();
            }
        }

        // Initialize dashboard on page load
        window.addEventListener('DOMContentLoaded', loadDashboard);
    </script>
</body>
</html>